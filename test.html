<!DOCTYPE html>
<html>
<head>
  <title>API CORS Test</title>
  <style>
    body { font-family: sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
    button { padding: 10px; margin: 10px 0; background: #0070f3; color: white; border: none; border-radius: 4px; cursor: pointer; }
    pre { background: #f1f1f1; padding: 10px; border-radius: 4px; overflow: auto; }
    .result { margin-top: 20px; }
  </style>
</head>
<body>
  <h1>API CORS Test</h1>
  
  <div>
    <button onclick="testRoot()">Test Root Endpoint</button>
    <button onclick="testPreflight()">Test Preflight Request</button>
    <button onclick="testLogin()">Test Login</button>
  </div>
  
  <div class="result">
    <h3>Results:</h3>
    <pre id="output">Click a button to start testing...</pre>
  </div>
  
  <script>
    const output = document.getElementById('output');
    const apiUrl = 'https://crm-deneme-backend.vercel.app';
    
    function showResult(title, data) {
      output.textContent += `\n\n${title}:\n${typeof data === 'object' ? JSON.stringify(data, null, 2) : data}`;
    }
    
    function showError(title, error) {
      output.textContent += `\n\n${title} ERROR:\n${error.message}`;
      console.error(error);
    }
    
    async function testRoot() {
      output.textContent = 'Testing root endpoint...';
      try {
        const response = await fetch(`${apiUrl}/`);
        const data = await response.json();
        showResult('Root endpoint response', data);
      } catch (error) {
        showError('Root endpoint', error);
      }
    }
    
    async function testPreflight() {
      output.textContent = 'Testing preflight request...';
      try {
        // Using XMLHttpRequest to better observe the preflight
        const xhr = new XMLHttpRequest();
        xhr.open('OPTIONS', `${apiUrl}/api/login`);
        
        xhr.onload = function() {
          output.textContent += `\n\nPreflight status: ${xhr.status}`;
          output.textContent += `\n\nResponse headers:\n`;
          
          const headers = xhr.getAllResponseHeaders();
          output.textContent += headers;
        };
        
        xhr.onerror = function(error) {
          showError('Preflight request', { message: 'Network error occurred' });
        };
        
        xhr.send();
      } catch (error) {
        showError('Preflight request', error);
      }
    }
    
    async function testLogin() {
      output.textContent = 'Testing login endpoint...';
      try {
        const response = await fetch(`${apiUrl}/api/login`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            username: 'test_user',
            password: 'test_password'
          })
        });
        
        const text = await response.text();
        try {
          const data = JSON.parse(text);
          showResult('Login response', data);
        } catch (e) {
          showResult('Login response (text)', text);
        }
      } catch (error) {
        showError('Login request', error);
      }
    }
  </script>
</body>
</html>